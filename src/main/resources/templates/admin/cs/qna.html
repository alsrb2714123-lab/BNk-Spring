<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QnA 관리 - 은행 펀드 상품 관리자</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin_styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin/admincs.css}">
</head>
<body>
    <!-- 사이드바 Fragment -->
    <div th:replace="~{admin/_sidebar :: sidebar('qna')}"></div>

    <div class="main-content">
        <!-- 헤더 Fragment -->
        <div th:replace="~{admin/_header :: header}"></div>
        <div class="main-content-body">
            <div class="container">
                <!-- 페이지 헤더 -->
                <header class="page-header">
                    <h1>QnA 관리</h1>
                    
                </header>

              
                <!-- QnA 검색 -->
                <div class="search-section">
                    <table class="search-table">
                        <tbody>
                            <tr>
                                <td class="search-label">QnA 검색</td>
                                <td class="search-inputs">
                                    <select class="form-select search-select-small" id="qnaSearchType">
                                        <option value="id">아이디</option>
                                        <option value="title">제목</option>
                                    </select>
                                    <input type="text" class="form-input search-input-large" id="qnaSearchInput" placeholder="입력하세요">
                                </td>
                            </tr>
                            <tr>
                                <td class="search-label">상태</td>
                                <td class="search-inputs">
                                    <div class="qna-status-radio">
                                        <label>
                                            <input type="radio" name="qnaStatus" value="all" checked>전체
                                        </label>
                                        <label>
                                            <input type="radio" name="qnaStatus" value="pending">답변대기
                                        </label>
                                        <label>
                                            <input type="radio" name="qnaStatus" value="completed">답변완료
                                        </label>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="search-actions">
                        <button class="btn btn-red" onclick="performSearch()">검색</button>
                        <button class="btn btn-secondary" onclick="resetSearch()">초기화</button>
                    </div>
                </div>

                <!-- QnA 목록 -->
                <div class="table-section">
                    <div class="table-info" id="qnaTableInfo">
                        <span>총 <strong>3</strong>건</span>
                        <span class="pagination-info">현재: <span>1</span>/<span>1</span> 페이지</span>
                    </div>
                    <div class="product-table">
                        <table class="qna-table">
                            <thead>
                                <tr>
                                    <th>번호</th>
                                    <th colspan="2">질문</th>
                                    <th>상태</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody id="qnaTableBody">
                                <tr>
                                    <td>9</td>
                                    <td colspan="2">
                                        <span th:onclick="'location.href=\'' + @{/admin/cs/qna/detail} + '?id=9\''" style="cursor: pointer;">펀드 투자 시 세금은 어떻게 되나요?</span>
                                    </td>
                                    <td>답변대기</td>
                                    <td>
                                        <div class="faq-action-buttons">
                                            <button class="btn btn-secondary btn-small" onclick="editQna(9)">답변</button>
                                            <button class="btn btn-secondary btn-small" onclick="deleteQna(9)">삭제</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <td colspan="2">
                                        <span th:onclick="'location.href=\'' + @{/admin/cs/qna/detail} + '?id=8\''" style="cursor: pointer;">펀드 환매는 언제 가능한가요?</span>
                                    </td>
                                    <td>답변완료</td>
                                    <td>
                                        <div class="faq-action-buttons">
                                            <button class="btn btn-secondary btn-small" onclick="editQna(8)">답변</button>
                                            <button class="btn btn-secondary btn-small" onclick="deleteQna(8)">삭제</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>7</td>
                                    <td colspan="2">
                                        <span th:onclick="'location.href=\'' + @{/admin/cs/qna/detail} + '?id=7\''" style="cursor: pointer;">펀드 수수료는 얼마인가요?</span>
                                    </td>
                                    <td>답변대기</td>
                                    <td>
                                        <div class="faq-action-buttons">
                                            <button class="btn btn-secondary btn-small" onclick="editQna(7)">답변</button>
                                            <button class="btn btn-secondary btn-small" onclick="deleteQna(7)">삭제</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="qna-pagination" id="qnaPagination">
                        <button class="page-btn prev">&lt;</button>
                        <div class="page-numbers">
                            <button class="page-number active">1</button>
                            <button class="page-number">2</button>
                            <button class="page-number">3</button>
                            <button class="page-number">4</button>
                            <button class="page-number">5</button>
                        </div>
                        <button class="page-btn next">&gt;</button>
                    </div>
                </div>

                <!-- 푸터 영역 -->
                <footer class="admin-footer"></footer>
            </div>
        </div>
    </div>
    <!-- 사이드바 스크립트 -->
    <div th:replace="~{admin/_sidebar :: sidebar-script}"></div>
    
    <script th:inline="javascript">
        /*<![CDATA[*/
        var editUrl = /*[[@{/admin/cs/qna/edit}]]*/ '/admin/cs/qna/edit';
        
        // QnA 검색 기능
        const qnaSearchInput = document.getElementById('qnaSearchInput');
        
        // 샘플 QnA 데이터
        const qnaData = [
            {
                id: 15,
                question: '펀드 투자 시 리스크는 무엇인가요?',
                answer: '펀드 투자에는 원금 손실 위험이 있습니다. 투자 전 펀드 설명서를 꼼꼼히 읽어보시기 바랍니다.',
                status: 'pending'
            },
            {
                id: 14,
                question: '펀드 수익률은 어떻게 확인하나요?',
                answer: '인터넷뱅킹 또는 모바일뱅킹에서 펀드 계좌 조회 메뉴에서 확인하실 수 있습니다.',
                status: 'completed'
            },
            {
                id: 13,
                question: '펀드 가입은 어떻게 하나요?',
                answer: '영업점 방문 또는 인터넷뱅킹을 통해 가입하실 수 있습니다.',
                status: 'pending'
            },
            {
                id: 12,
                question: '펀드 해지는 언제 가능한가요?',
                answer: '펀드 해지는 영업일 기준으로 신청하실 수 있으며, 펀드 종류에 따라 해지 가능일이 다를 수 있습니다.',
                status: 'completed'
            },
            {
                id: 11,
                question: '펀드 투자 한도는 얼마인가요?',
                answer: '펀드 투자 한도는 펀드 종류와 개인 투자 한도에 따라 다를 수 있습니다.',
                status: 'pending'
            },
            {
                id: 10,
                question: '펀드 수익에 대한 세금은 어떻게 되나요?',
                answer: '펀드 수익에 대해서는 원천징수 방식으로 세금이 부과됩니다.',
                status: 'completed'
            },
            {
                id: 9,
                question: '펀드 투자 시 세금은 어떻게 되나요?',
                answer: '펀드 투자 시 발생하는 수익에 대해서는 원천징수 방식으로 세금이 부과됩니다. 자세한 내용은 고객센터로 문의해 주시기 바랍니다.',
                status: 'pending'
            },
            {
                id: 8,
                question: '펀드 환매는 언제 가능한가요?',
                answer: '펀드 환매는 영업일 기준으로 신청하실 수 있으며, 펀드 종류에 따라 환매 가능일이 다를 수 있습니다.',
                status: 'completed'
            },
            {
                id: 7,
                question: '펀드 수수료는 얼마인가요?',
                answer: '펀드 수수료는 펀드 종류에 따라 다르며, 펀드 설명서에 자세히 명시되어 있습니다.',
                status: 'pending'
            },
            {
                id: 6,
                question: '펀드 투자 시 주의사항은 무엇인가요?',
                answer: '펀드 투자 시 원금 손실 위험이 있으므로 투자 전 충분히 검토하시기 바랍니다.',
                status: 'completed'
            }
        ];

        // 원본 QnA 목록 저장
        const originalTableBody = document.getElementById('qnaTableBody').innerHTML;
        const originalTableInfo = document.getElementById('qnaTableInfo').innerHTML;
        const originalPagination = document.getElementById('qnaPagination').innerHTML;

        function performSearch() {
            const searchTerm = qnaSearchInput.value.trim().toLowerCase();
            const searchType = document.getElementById('qnaSearchType').value;
            const statusRadio = document.querySelector('input[name="qnaStatus"]:checked');
            const status = statusRadio ? statusRadio.value : 'all';
            const qnaTableBody = document.getElementById('qnaTableBody');
            const qnaTableInfo = document.getElementById('qnaTableInfo');
            const qnaPagination = document.getElementById('qnaPagination');
            
            let results = qnaData.filter(qna => {
                // 검색어 필터링
                let matchesSearch = true;
                if (searchTerm !== '') {
                    if (searchType === 'id') {
                        matchesSearch = qna.id.toString().includes(searchTerm);
                    } else if (searchType === 'title') {
                        matchesSearch = qna.question.toLowerCase().includes(searchTerm);
                    }
                }
                
                // 상태 필터링
                let matchesStatus = true;
                if (status === 'pending') {
                    matchesStatus = qna.status === 'pending';
                } else if (status === 'completed') {
                    matchesStatus = qna.status === 'completed';
                }
                
                return matchesSearch && matchesStatus;
            });

            // 테이블 정보 업데이트
            qnaTableInfo.innerHTML = `
                <span>검색결과: <strong>${results.length}</strong>건</span>
                <span class="pagination-info">검색어: "${qnaSearchInput.value}"</span>
            `;

            // 검색 결과를 테이블에 표시
            if (results.length > 0) {
                const detailUrl = /*[[@{/admin/cs/qna/detail}]]*/ '/admin/cs/qna/detail';
                qnaTableBody.innerHTML = results.map((qna, index) => `
                    <tr>
                        <td>${qna.id}</td>
                        <td colspan="2">
                            <span style="cursor: pointer;" onclick="location.href='${detailUrl}?id=' + ${qna.id}">${qna.question}</span>
                        </td>
                        <td>${qna.status === 'pending' ? '답변대기' : '답변완료'}</td>
                        <td>
                            <div class="faq-action-buttons">
                                <button class="btn btn-secondary btn-small" onclick="editQna(${qna.id})">답변</button>
                                <button class="btn btn-secondary btn-small" onclick="deleteQna(${qna.id})">삭제</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } else {
                qnaTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="faq-no-results-cell">
                            검색 결과가 없습니다.
                        </td>
                    </tr>
                `;
            }

            // 페이지네이션 숨기기
            qnaPagination.innerHTML = '';
        }

        function resetSearch() {
            document.getElementById('qnaSearchInput').value = '';
            document.getElementById('qnaSearchType').value = 'id';
            const allRadio = document.querySelector('input[name="qnaStatus"][value="all"]');
            if (allRadio) {
                allRadio.checked = true;
            }
            
            const qnaTableBody = document.getElementById('qnaTableBody');
            const qnaTableInfo = document.getElementById('qnaTableInfo');
            const qnaPagination = document.getElementById('qnaPagination');
            
            // 원본 목록 복원
            qnaTableBody.innerHTML = originalTableBody;
            qnaTableInfo.innerHTML = originalTableInfo;
            qnaPagination.innerHTML = originalPagination;
        }

        qnaSearchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        function editQna(id) {
            if (id) {
                location.href = editUrl + '?id=' + id;
            } else {
                alert('QnA ID가 없습니다.');
            }
        }

        function deleteQna(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                alert('QnA 삭제 기능: ID ' + id);
                // 삭제 로직 구현
            }
        }
        /*]]>*/
    </script>
</body>
</html>

