<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품 카테고리 관리 - 은행 펀드 상품 관리자</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin_styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin/adminproduct.css}">
    <link rel="stylesheet" th:href="@{/css/admin/settings_styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin/category_management.css}">
</head>
<body>
    <!-- 사이드바 Fragment -->
    <div th:replace="~{admin/_sidebar :: sidebar('settings-category')}"></div>

    <div class="main-content">
        <!-- 헤더 Fragment -->
        <div th:replace="~{admin/_header :: header}"></div>

    <div class="main-content-body">
        <div class="container category-page">
            <header class="page-header">
                <div>
                    <h1>상품 카테고리 관리</h1>
                    <p>은행 표준 분류를 자체 운영합니다. 사용 수가 0일 때만 삭제할 수 있습니다.</p>
                </div>
                <div class="header-actions">
                    <button id="openModalBtn" class="btn btn-primary">신규 등록</button>
                </div>
            </header>

            <section class="summary-cards">
                <article class="summary-card">
                    <span>총 카테고리</span>
                    <strong id="summaryTotal">0</strong>
                </article>
                <article class="summary-card">
                    <span>노출(ON)</span>
                    <strong id="summaryActive">0</strong>
                </article>
                <article class="summary-card">
                    <span>숨김(OFF)</span>
                    <strong id="summaryInactive">0</strong>
                </article>
                <article class="summary-card">
                    <span>펀드 매핑 수</span>
                    <strong id="summaryUsage">0</strong>
                </article>
                <article class="summary-card">
                    <span>최근 갱신</span>
                    <strong id="summaryUpdated">-</strong>
                </article>
            </section>

            <!-- 검색 섹션 -->
            <div class="search-section">
                <form th:action="@{/admin/settings/category}" method="get" style="margin: 0;">
                    <table class="search-table">
                        <tbody>
                            <tr>
                                <td class="search-label">검색</td>
                                <td class="search-inputs">
                                    <input type="text" class="form-input search-input-large" id="filterKeyword" name="keyword" placeholder="예: 주식형 / CAT-010 / equity" th:value="${pageRequestDTO != null ? pageRequestDTO.keyword : ''}">
                                </td>
                            </tr>
                            <tr>
                                <td class="search-label">유형</td>
                                <td class="search-inputs">
                                    <select class="form-select search-select-medium" id="filterType" name="type">
                                        <option value="">전체</option>
                                    </select>
                                    <label style="display: flex; align-items: center; gap: 8px; margin-left: 20px;">
                                        <input type="checkbox" id="filterActiveOnly" name="activeOnly" style="width: auto; margin: 0;" th:checked="${pageRequestDTO != null and pageRequestDTO.activeOnly}">
                                        노출만 보기
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; margin-left: 20px;">
                                        <input type="checkbox" id="filterUsageZero" name="usageZero" style="width: auto; margin: 0;" th:checked="${pageRequestDTO != null and pageRequestDTO.usageZero}">
                                        사용 수 0만 보기
                                    </label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="search-actions">
                        <button class="btn btn-search" type="submit">조회</button>
                        <button class="btn btn-secondary" type="button" th:onclick="|location.href='@{/admin/settings/category}'|">초기화</button>
                    </div>
                </form>
            </div>

            <section class="category-table-wrap">
                <header>
                    <div>카테고리 목록 (<strong id="rowCount">0</strong>건)</div>
                    <div class="note">삭제는 사용 수 0일 때만 가능 · 숨김은 프론트 및 검색에서 제외됩니다.</div>
                </header>
                <table class="category-table">
                    <thead>
                    <tr>
                        <th class="code-col">코드</th>
                        <th>이름</th>
                        <th>유형</th>
                        <th>상위</th>
                        <th>Slug</th>
                        <th class="num-col">사용수</th>
                        <th class="status-col">노출</th>
                        <th class="action-col">관리</th>
                    </tr>
                    </thead>
                    <tbody id="categoryRows">
                    <tr><td colspan="8" class="empty-row">조건에 맞는 항목이 없습니다.</td></tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <button class="page-btn prev" disabled>&lt;</button>
                    <div class="page-numbers">
                        <button class="page-number active">1</button>
                    </div>
                    <button class="page-btn next" disabled>&gt;</button>
                </div>
            </section>
            <!-- 푸터 영역 -->
            <footer class="admin-footer"></footer>
        </div>
    </div>
</div>

<div id="categoryModal" class="modal-overlay">
    <div class="modal-card category-modal">
        <h3 id="modalTitle">카테고리 등록</h3>
        <form id="modalForm" class="modal-form">
            <div class="form-grid">
                <label>
                    상위
                    <select id="modalParent">
                        <option value="">(없음)</option>
                    </select>
                </label>
                <label>
                    유형(Type)
                    <select id="modalType" required></select>
                </label>
                <label class="full">
                    이름(한글)
                    <input id="modalName" type="text" minlength="2" required>
                </label>
                <label class="full">
                    Slug
                    <div class="slug-field">
                        <input id="modalSlug" type="text" pattern="^[a-z0-9-]+$" required>
                        <button type="button" id="slugAutoBtn" class="btn btn-secondary">자동</button>
                    </div>
                    <small>소문자/숫자/하이픈만 사용 · 다른 카테고리와 중복 불가</small>
                </label>
                <label>
                    정렬값
                    <input id="modalSort" type="number" min="0" step="10" value="10">
                </label>
                <label>
                    노출
                    <button type="button" id="modalActive" class="toggle-pill on" data-value="true">ON</button>
                </label>
            </div>
            <div class="modal-actions">
                <button type="button" id="modalCancel" class="btn btn-secondary">취소</button>
                <button type="submit" class="btn btn-primary">저장</button>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/js/admin/category_management.js}"></script>
    <!-- 사이드바 스크립트 -->
    <div th:replace="~{admin/_sidebar :: sidebar-script}"></div>
</body>
</html>
